"use strict";function RussianDoll(e){if(!_.isString(e))throw new TypeError(errorMessages.sourceMustBeString);this.source=e,this.tokens=tokenizer(this.source),this.html=parser(this.tokens)}var errorMessages={sourceMustBeString:"Source must be a string",unmatchedCurlyBrackets:"Unmatched curly brackets {}",paragraphInFragment:"Cannot nest a paragraph inside a fragment"},regExps={elements:{curlyBrackets:/(\{(?:[A-z\u00C0-\u00ff\d-_']+\:)?|\})/,paragraph:/(\>[A-z\u00C0-\u00ff\d-_']*)\s?/g,fragmentLink:/(\[[^\]]*\](?:#[A-z\u00C0-\u00ff\d-_']+)?)/g},matches:{paragraph:/\>([A-z\u00C0-\u00ff\d-_']*)\s?/g,fragmentLink:/\[([^\]]*)\](?:#([A-z\u00C0-\u00ff\d-_']+))?/g,fragmentOpen:/\{(?:([A-z\u00C0-\u00ff\d-_']+)\:)?/g,fragmentClose:/\}/g},tags:{strikethrough:/~~([^~]+?)~~/g,bold:/(?:\*\*|__)([^\*]+?)(?:\*\*|__)/g,italic:/(?:\*|_)([^\*]+?)(?:\*|_)/g,image:/!\(([^\)]*)\)/g,link:/@([^\(]+)\((http(s)?:\/\/.*)\)/g}},safeStr=function(e){return(/^[0-9]+$/.test(e)||/^_/.test(e)?"_":"")+_.kebabCase(_.deburr(_.escape(e)))},markup=function(e){return _.escape(e).replace(regExps.tags.strikethrough,"<del>$1</del>").replace(regExps.tags.bold,"<strong>$1</strong>").replace(regExps.tags.italic,"<em>$1</em>").replace(regExps.tags.image,'<img src="$1" />').replace(regExps.tags.link,'<a href="$2" target="_blank" class="external">$1</a>')},tokenizer=function(e){if(_.size(e.match(/\{/))!=_.size(e.match(/\}/)))throw new SyntaxError(errorMessages.unmatchedCurlyBrackets);return e=[e],e=_.map(_.compact(_.flatten(e)),function(e){return e.split(regExps.elements.curlyBrackets)}),e=_.map(_.compact(_.flatten(e)),function(e){return e.split(regExps.elements.paragraph)}),e=_.map(_.compact(_.flatten(e)),function(e){return e.split(regExps.elements.fragmentLink)}),_.compact(_.flatten(e))},parser=function(e){var r=[[]],a=0,t=_.reduce(e,function(e,t,n){var s={};if(_.each(_.clone(regExps.matches),function(e,r){e.lastIndex=0,s[r]=e.exec(t)}),s.paragraph){if(a>0)throw new SyntaxError(errorMessages.paragraphInFragment);var g=s.paragraph[1]?' data-opened-by="'+safeStr(s.paragraph[1])+'"':"";e+="</p><p"+g+">"}else if(s.fragmentOpen){var p=s.fragmentOpen[1]?safeStr(s.fragmentOpen[1]):_.first(_.last(r));r[_.size(r)-1].shift(),e+='<span data-opened-by="'+(p||"_nothing")+'">',r.push([]),a++}else if(s.fragmentClose)e+="</span>",r.pop(),a--;else if(s.fragmentLink){var p=void 0;s.fragmentLink[2]?p=safeStr(s.fragmentLink[2]):(p=_.uniqueId(),r[r.length-1].push(p)),e+='<a href="#" data-opens="'+p+'">'+s.fragmentLink[1]+"</a>"}else e+=markup(t);return e},"");return"<p>"+t+"</p>"};
//# sourceMappingURL=russiandoll-1.0.0.min.js.map